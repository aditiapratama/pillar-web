| {% block body %}

#node-container

	section.node-preview.group
		| {% if node.picture %}
		img.backdrop(src="{{ node.picture.thumbnail('l', api=api) }}")
		.overlay
		| {% endif %}
		.node-title
			| {{node.name}}

	section.node-details-container.group

		| {% if node.description %}
		.node-details-description
			| {{node.description}}
		| {% endif %}

	section.node-children.group

		| {% if children %}
		| 	{% for child in children %}

		a(href="#", data-node_id="{{ child._id }}", title="{{ child.name }}", class="item_icon")
			.list-node-children-item
				.list-node-children-item-thumbnail

					| {% if child.picture %}
					img(
						src="{{ child.picture.thumbnail('b', api=api)}} ")
					| {% endif %}

					.list-node-children-item-thumbnail-icon
						| {% if child.properties.content_type %}

						| {% if child.properties.content_type == 'video' %}
						i.pi-play
						| {% endif %}

						| {% else %}
						i.pi-folder
						| {% endif %}

				.list-node-children-item-name

					| {% if child.properties.content_type == 'video' %}
					i.pi-film-thick
					| {% elif child.properties.content_type == 'image' %}
					i.pi-image
					| {% elif child.properties.content_type == 'file' %}
					i.pi-document
					| {% else %}
					i.pi-folder
					| {% endif %}

					span {{ child.name }}

		| 	{% endfor %}
		| {% endif %}

	script.
		$('a.item_icon').unbind("click");
		$('a.item_icon').click(function(e){
			e.preventDefault;
			// When clicking on a node preview, we load its content
			var nodeId = $(this).data('node_id');
			// displayNode will run asynchronously and set the bcloud_current_node_id
			// as well, but we set it manually in the next line as well, to make sure
			// that select_node on jstree works as expected, preventing the node to be
			// loaded twice.
			Cookies.set('bcloud_current_node_id', nodeId);
			displayNode(nodeId);
			// Update tree with current selection
			$('#project_tree').jstree('select_node', 'n_' + nodeId);

		});

include ../_scripts

| {% endblock %}

